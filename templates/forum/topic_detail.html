{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block title %}{{ topic.title }} ‚Äî MiniForum{% endblock %}

{% block content %}
<div class="container mt-4">

  <!-- üßµ –û—Å–Ω–æ–≤–Ω–∞—è —Ç–µ–º–∞ -->
  <div class="card mb-4">
    <div class="card-body">
      <div class="d-flex">
        <img src="{{ topic.author.profile.avatar.url }}" class="rounded-circle mr-3" width="50" height="50">
        <div>
          <h4 class="mb-0">{{ topic.title }}</h4>
          <small class="text-muted">
            –ö–∞—Ç–µ–≥–æ—Ä–∏—è: {{ topic.category.name }} |
            –ê–≤—Ç–æ—Ä: {{ topic.author.username }} |
            {{ topic.created_at|date:"d.m.Y H:i" }}
          </small>
        </div>
      </div>

      <hr>
      <p class="mt-2">{{ topic.content|linebreaks }}</p>

      {% if topic.image %}
        <img src="{{ topic.image.url }}" class="img-fluid mt-3" style="max-height: 300px;">
      {% endif %}
    </div>
    <div class="card-footer text-muted d-flex justify-content-between">
      <div>
        ‚ù§Ô∏è –õ–∞–π–∫–∏: {{ topic.likes.count }} |
        üëÅ –ü—Ä–æ—Å–º–æ—Ç—Ä—ã: {{ topic.views }}
      </div>
      {% if user.is_authenticated %}
        <form action="{% url 'like_topic' topic.id %}" method="post" class="d-inline">
          {% csrf_token %}
          {% if user in topic.likes.all %}
            <button type="submit" class="btn btn-sm btn-danger">–£–±—Ä–∞—Ç—å –ª–∞–π–∫</button>
          {% else %}
            <button type="submit" class="btn btn-sm btn-outline-primary">–õ–∞–π–∫–Ω—É—Ç—å ‚ù§Ô∏è</button>
          {% endif %}
        </form>
      {% endif %}
    </div>
  </div>

  <!-- üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ -->
  <h5>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h5>
  {% for post in posts %}
    <div class="media mb-3 p-3 border rounded">
      <img src="{{ post.author.profile.avatar.url }}" class="rounded-circle mr-3" width="40" height="40">
      <div class="media-body">
        <h6 class="mt-0">{{ post.author.username }}
          <small class="text-muted">‚Äî {{ post.created_at|date:"d.m.Y H:i" }}</small>
        </h6>
        <p>{{ post.content }}</p>
      </div>
    </div>
  {% empty %}
    <p class="text-muted">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</p>
  {% endfor %}

  <!-- ‚úçÔ∏è –§–æ—Ä–º–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
  {% if user.is_authenticated %}
    <div class="mt-4">
      <h5>–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</h5>
      <form method="post">
        {% csrf_token %}
        {{ form|crispy }}
        <button class="btn btn-success">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      </form>
    </div>
  {% else %}
    <p class="mt-3">–ß—Ç–æ–±—ã –∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, <a href="{% url 'login' %}">–≤–æ–π–¥–∏—Ç–µ</a>.</p>
  {% endif %}
</div>
{% endblock %}
